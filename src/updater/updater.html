<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunii Updater</title>
    <link rel="stylesheet" href="updater.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Title Bar -->
    <div class="title-bar">
        <div class="title-bar-left">
            <div class="app-logo">
                <img src="../../assets/lunii-icon.png" alt="Lunii" width="16" height="16">
            </div>
            <span class="app-title">Lunii Updater</span>
        </div>
        <div class="title-bar-controls">
            <button class="control-btn close" id="close-btn">Ã—</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="updater-container">
        <!-- Update Available Screen -->
        <div class="update-screen active" id="update-available-screen">
            <div class="update-header">
                <div class="update-icon">
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                        <circle cx="24" cy="24" r="20" stroke="url(#gradient1)" stroke-width="2" fill="none"/>
                        <path d="M24 16V24L30 30" stroke="url(#gradient1)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <defs>
                            <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#4F46E5"/>
                                <stop offset="100%" style="stop-color:#7C3AED"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <h1 class="update-title">Update Available</h1>
                <p class="update-subtitle">A new version of Lunii is ready to install</p>
            </div>

            <div class="update-content">
                <div class="version-info">
                    <div class="version-item">
                        <span class="version-label">Current Version</span>
                        <span class="version-value current" id="current-version">1.0.0</span>
                    </div>
                    <div class="version-arrow">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <div class="version-item">
                        <span class="version-label">New Version</span>
                        <span class="version-value new" id="new-version">1.1.0</span>
                    </div>
                </div>

                <div class="update-details">
                    <div class="detail-item">
                        <span class="detail-label">Release Name</span>
                        <span class="detail-value" id="release-name">Version 1.1.0</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Download Size</span>
                        <span class="detail-value" id="download-size">~5 MB</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Published</span>
                        <span class="detail-value" id="publish-date">Just now</span>
                    </div>
                </div>

                <div class="release-notes">
                    <h3>What's New</h3>
                    <div class="notes-content" id="release-notes">
                        <p>Loading release notes...</p>
                    </div>
                </div>
            </div>

            <div class="update-actions">
                <button class="update-btn secondary" id="later-btn">Later</button>
                <button class="update-btn primary" id="download-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M8 12L3 7L4.5 5.5L7 8V1H9V8L11.5 5.5L13 7L8 12Z" fill="currentColor"/>
                        <path d="M1 13H15V15H1V13Z" fill="currentColor"/>
                    </svg>
                    Download Update
                </button>
            </div>
        </div>

        <!-- Download Progress Screen -->
        <div class="update-screen" id="download-progress-screen">
            <div class="progress-header">
                <div class="progress-icon">
                    <div class="spinner"></div>
                </div>
                <h1 class="progress-title">Downloading Update</h1>
                <p class="progress-subtitle" id="progress-message">Preparing download...</p>
            </div>

            <div class="progress-content">
                <div class="progress-bar-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text">
                        <span id="progress-percent">0%</span>
                        <span id="progress-size">0 / 0 MB</span>
                    </div>
                </div>

                <div class="progress-details">
                    <div class="detail-item">
                        <span class="detail-label">Status</span>
                        <span class="detail-value" id="download-status">Initializing...</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Speed</span>
                        <span class="detail-value" id="download-speed">Calculating...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Installation Screen -->
        <div class="update-screen" id="installation-screen">
            <div class="install-header">
                <div class="install-icon">
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none">
                        <circle cx="24" cy="24" r="20" stroke="url(#gradient2)" stroke-width="2" fill="none"/>
                        <path d="M16 24L20 28L32 16" stroke="url(#gradient2)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <defs>
                            <linearGradient id="gradient2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#22c55e"/>
                                <stop offset="100%" style="stop-color:#16a34a"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <h1 class="install-title">Update Complete</h1>
                <p class="install-subtitle">Lunii has been successfully updated</p>
            </div>

            <div class="install-content">
                <div class="success-message">
                    <p>The update has been installed successfully. Please restart Lunii to use the new version.</p>
                </div>
            </div>

            <div class="install-actions">
                <button class="update-btn secondary" id="restart-later-btn">Restart Later</button>
                <button class="update-btn primary" id="restart-now-btn">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C6.49 15 5.1 14.5 4 13.6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M1 11L4 13.6L6 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Restart Now
                </button>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        
        // Expose electronAPI to window
        window.electronAPI = {
            // Send events
            send: (channel, ...args) => {
                ipcRenderer.send(channel, ...args);
            },
            
            // Invoke methods
            invoke: (channel, ...args) => {
                return ipcRenderer.invoke(channel, ...args);
            },
            
            // Event listeners
            onUpdaterProgress: (callback) => {
                ipcRenderer.on('updater-progress', callback);
            },
            
            // Remove listeners
            removeAllListeners: (channel) => {
                ipcRenderer.removeAllListeners(channel);
            }
        };
    </script>
    <script src="updater-renderer.js"></script>
</body>
</html>